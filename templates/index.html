{% extends "base.html" %}

{% block title %}
{{ super() }}
{% if not title %}Speed-o-Mat{% endif %}
{% endblock %}

{% block style %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
crossorigin=""/>

<style>
    /* Set the size of the div element that contains the map */
    #map {
    /*height: 100vh;*/
    width: 100%;
    }
</style>
{% endblock %}

{% block backbutton%}
{% endblock %}

{% block content %}
{{ super() }}
<div class="row">

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-success shadow h-100 py-2">
        <div class="card-body">
            <div class="row no-gutters align-items-center">
            <div class="col mr-2">
                <div class="text-xs font-weight-bold text-success text-uppercase mb-1">{{ device.register0_name }}</div>
                <div class="h5 mb-0 font-weight-bold text-gray-800" id="register0">{{ device.register0_value }} {{ device.register0_unit }}</div>
            </div>
            <div class="col-auto">
                <i class="fas fa-bolt fa-2x text-gray-300"></i>
            </div>
            </div>
        </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-primary shadow h-100 py-2">
        <div class="card-body">
            <div class="row no-gutters align-items-center">
            <div class="col mr-2">
                <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">{{ device.register1_name }}</div>
                <div class="h5 mb-0 font-weight-bold text-gray-800" id="register1">{{ device.register1_value }} {{ device.register1_unit }}</div>
            </div>
            <div class="col-auto">
                <i class="fas fa-bolt fa-2x text-gray-300"></i>
            </div>
            </div>
        </div>
        </div>
    </div>    

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-danger shadow h-100 py-2">
        <div class="card-body">
            <div class="row no-gutters align-items-center">
            <div class="col mr-2">
                <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">Batterie</div>
                <div class="row no-gutters align-items-center">
                <div class="col-auto">
                    <div class="h5 mb-0 mr-3 font-weight-bold text-gray-800" id="battery_perc">{{ device.batteryPerc }} %</div>
                </div>
                <div class="col">
                    <div class="progress progress-sm mr-2">
                    <div class="progress-bar bg-danger" role="progressbar" style="width:{{ device.batteryPerc }}%" aria-valuenow="{{ device.batteryPerc }}" aria-valuemin="0" aria-valuemax="100" id="device.batteryPerc"></div>
                    </div>
                </div>
                </div>
            </div>
            <div class="col-auto">
                <i class="fas fa-battery-half fa-2x text-gray-300"></i>
            </div>
            </div>
        </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-warning shadow h-100 py-2">
        <div class="card-body">
            <div class="row no-gutters align-items-center">
            <div class="col mr-2">
                <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">LastSeen</div>
                <div class="h5 mb-0 font-weight-bold text-gray-800" id="lastseen_at">{{ device.lastseen_at }}</div>
            </div>
            <div class="col-auto">
                <i class="fas fa-receipt fa-2x text-gray-300"></i>
            </div>
            </div>
        </div>
        </div>
    </div>
</div>


<div class="row">

    <!-- Loadprofile -->
    <div class="col-lg-12">

        <!-- Dropdown Card Example -->
        <div class="card shadow mb-4">
            <!-- Card Header - Dropdown -->
            <div
                class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-primary">Lastverlauf</h6>
                <div class="dropdown no-arrow">
                    <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
                        aria-labelledby="dropdownMenuLink">
                        <div class="dropdown-header">Zeitraum:</div>
                        <a class="dropdown-item" href="#">Jahr (letzte 12 Monate)</a>
                        <a class="dropdown-item" href="#">Monat (letze 30 Tage)</a>
                        <a class="dropdown-item" href="#">Tag (letzte 24 Stunden)</a>
                    </div>
                </div>
            </div>
            <!-- Card Body -->
            <div class="card-body">
                <div class="chart-container" style="position: relative; height:30vh;">
                    <canvas id="myAreaChart"></canvas>
                </div>
                <hr>
                Lastverlauf der Register in den <code>letzten 30 Tagen</code>.
            </div>
        </div>

    </div>

</div>



<div class="row">

    <!-- Collapsable Card Example -->
    <div class="col-lg-6">
        <div class="card shadow mb-4">
            <!-- Card Header - Accordion -->
            <a href="#collapseCardExample" class="d-block card-header py-3" data-toggle="collapse" role="button" aria-expanded="true" aria-controls="collapseCardExample">
                <h6 class="m-0 font-weight-bold text-primary">Was ist ein Klax ?</h6>
            </a>
            <!-- Card Content - Collapse -->
            <div class="collapse show" id="collapseCardExample">
                <div class="card-body">
                    <p>Der KLAX macht die Werte von modernen Stromzählern sofort verfügbar und hilft dadurch wirkungsvolle Energiesparmaßnahmen umzusetzen sowie Transparenz zu schaffen. Dazu wird der KLAX per Magnet an die integrierte, optische Schnittstelle von modernen Messeinrichtungen (mME) angeheftet. Die Signale der Infrarot-Schnittstelle werden über den Optokopf aufgenommen und per LoRaWAN übertragen. 
                    Die ermittelten Messwerte stehen bereits kurz nach der Messung im LoRaWAN-Backend zur Verfügung und können mit geeigneter Software weiterverarbeitet werden.
                    <b>MyKlax</b> ist eine solche Software die über das MQTT Protokoll von Ihrem LoRaWAN-Backend in Echtzeit Zählerstände empfängt und verarbeitet.</p>
                    <p>Ihren Klax können Sie z.B. über <b><a target="_blank" href="https://iot-shop.de/klax">iot-shop.de</a></b> beziehen!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Device Data -->
    <div class="col-lg-6">
        <!-- Bar Chart -->
        <div class="card shadow mb-4">
            <!-- Card Header - Accordion -->
            <a href="#collapseMyKlax" class="d-block card-header py-3" data-toggle="collapse" role="button" aria-expanded="true" aria-controls="collapseMyKlax">
                <h6 class="m-0 font-weight-bold text-primary">Mein Klax</h6>
            </a>
            <!-- Card Content - Collapse -->
            <div class="collapse show" id="collapseMyKlax">
                <div class="card-body">
                    <p>Server Migration <span class="float-right">20%</span>
                    <div class="progress mb-4">
                        <div class="progress-bar bg-danger" role="progressbar" style="width: 20%"
                            aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div>
                    </div></p>
                    <p>Sales Tracking <span class="float-right">40%</span>
                    <div class="progress mb-4">
                        <div class="progress-bar bg-warning" role="progressbar" style="width: 40%"
                            aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"></div>
                    </div></p>
                    <p>Customer Database <span class="float-right">60%</span></p>
                    <p>Payout Details <span  class="float-right">80%</span></p>
                    <p>Account Setup <span class="float-right">Complete!</span>
                    <div class="progress">
                        <div class="progress-bar bg-success" role="progressbar" style="width: 100%"
                            aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                    </div></p>
                    <hr>
                    Connectivity zu Ihrem <code>KLAX</code>.
                </div>
            </div>
        </div>
    </div>


</div>



{% endblock %}

{% block script %}
<!-- Page level plugins -->
 <!-- Make sure you put this AFTER Leaflet's CSS -->
 <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
   integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
   crossorigin=""></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>

<!-- Page level custom scripts -->
<script src="{{ url_for('static', path='/js/chart-functions.js') }}"></script>
<script src="{{ url_for('static', path='/js/charts-myklax.js') }}"></script>
<script src="{{ url_for('static', path='/js/demo/chart-area-demo.js') }}"></script>

<script>
    $(document).ready(function () {

        // Update Charts
        fetch("{{ url_for('ChartLoadprofile') }}")
        .then((response) => response.json()) // Transform the data into json
            .then(function(data) {
                const ctx = document.getElementById("idChartLoadprofile");
                const myChart = drawChartLoadprofile(ctx, data);
        })
    });
</script>
{% endblock %}